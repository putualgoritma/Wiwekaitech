{% extends "base.html" %}

{% block title %}Products - Wiwekaitech Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Products</h2>
    {% if user.role in ['admin', 'editor'] %}
    <a href="/admin/products/create" class="btn btn-primary">Add Product</a>
    {% endif %}
</div>

{% if products %}
<div class="content-table">
    <table>
        <thead>
            <tr>
                <th>Title (EN)</th>
                <th>Slug</th>
                <th>Icon</th>
                <th>Status</th>
                <th>Order</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.title_en }}</td>
                <td><code>{{ product.slug }}</code></td>
                <td>{{ product.icon or '-' }}</td>
                <td>
                    {% if product.is_active %}
                    <span class="badge badge-success">Active</span>
                    {% else %}
                    <span class="badge badge-warning">Inactive</span>
                    {% endif %}
                </td>
                <td>{{ product.display_order }}</td>
                <td class="actions">
                    <a href="/admin/products/{{ product.id }}/edit" class="btn btn-sm btn-info">Edit</a>
                    {% if user.role in ['admin', 'editor'] %}
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct({{ product.id }})">Delete</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <p>No products found.</p>
    {% if user.role in ['admin', 'editor'] %}
    <a href="/admin/products/create" class="btn btn-primary">Create the first product</a>
    {% endif %}
</div>
{% endif %}

<script>
async function deleteProduct(productId) {
    if (confirm('Are you sure you want to delete this product?')) {
        try {
            const response = await fetch(`/api/v1/admin/products/${productId}`, {
                method: 'DELETE',
            });
            
            if (response.ok) {
                alert('Product deleted successfully');
                location.reload();
            } else {
                const data = await response.json();
                alert('Error: ' + (data.detail || 'Failed to delete'));
            }
        } catch (error) {
            alert('An error occurred: ' + error.message);
        }
    }
}
</script>
{% endblock %}
