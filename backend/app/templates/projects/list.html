{% extends "base.html" %}

{% block title %}Projects - Wiwekaitech Admin{% endblock %}

{% block content %}
<div class="page-header">
    <h2>Projects</h2>
    {% if user.role in ['admin', 'editor'] %}
    <a href="/admin/projects/create" class="btn btn-primary">Add Project</a>
    {% endif %}
</div>

{% if projects %}
<div class="content-table">
    <table>
        <thead>
            <tr>
                <th>Title (EN)</th>
                <th>Client</th>
                <th>Industry</th>
                <th>Featured</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for project in projects %}
            <tr>
                <td>{{ project.title_en }}</td>
                <td>{{ project.client_name or '-' }}</td>
                <td>{{ project.industry or '-' }}</td>
                <td>
                    {% if project.is_featured %}
                    <span class="badge badge-success">Yes</span>
                    {% else %}
                    <span class="badge badge-secondary">No</span>
                    {% endif %}
                </td>
                <td>
                    {% if project.is_active %}
                    <span class="badge badge-success">Active</span>
                    {% else %}
                    <span class="badge badge-warning">Inactive</span>
                    {% endif %}
                </td>
                <td class="actions">
                    <a href="/admin/projects/{{ project.id }}/edit" class="btn btn-sm btn-info">Edit</a>
                    {% if user.role in ['admin', 'editor'] %}
                    <button class="btn btn-sm btn-danger" onclick="deleteProject({{ project.id }})">Delete</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="empty-state">
    <p>No projects found.</p>
    {% if user.role in ['admin', 'editor'] %}
    <a href="/admin/projects/create" class="btn btn-primary">Create the first project</a>
    {% endif %}
</div>
{% endif %}

<script>
async function deleteProject(projectId) {
    if (confirm('Are you sure you want to delete this project?')) {
        try {
            const response = await fetch(`/api/v1/admin/projects/${projectId}`, {
                method: 'DELETE',
            });
            if (response.ok) {
                alert('Project deleted successfully');
                location.reload();
            } else {
                const data = await response.json();
                alert('Error: ' + (data.detail || 'Failed to delete'));
            }
        } catch (error) {
            alert('An error occurred: ' + error.message);
        }
    }
}
</script>
{% endblock %}
